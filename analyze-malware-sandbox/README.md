# Malware Inspection Sandbox

Sandboxed environment for analyzing suspicious files on macOS using UTM and Alpine Linux.

## Features

- Isolated VM environment (UTM with Alpine Linux)
- Network isolation (VM cannot access host or network)
- Read-only file sharing (malware cannot write to host)
- Analysis tools: ClamAV, strings, hexdump, oletools, exiftool
- Automated setup and provisioning

## Prerequisites

```bash
brew install --cask utm
brew install utmctl
```

## Quick Start

### Step 1: Initial Setup

Run the setup script to download Alpine Linux and create SSH keys:

```bash
./setup-sandbox.sh
```

This will:
- Check dependencies
- Download Alpine Linux ISO (~207 MB)
- Generate SSH keys for secure VM access
- Create the `shared/` directory

### Step 2: Create and Configure VM

See [SETUP-GUIDE.md](SETUP-GUIDE.md) for detailed instructions. Quick summary:

1. Create VM in UTM (Emulate mode, x86_64, 2GB RAM, 8GB disk)
2. Configure network with port forwarding (127.0.0.1:2222 → 22)
3. Add shared directory (read-only)
4. Install Alpine Linux using `setup-alpine`
5. Configure SSH access
6. Isolate network after setup complete

Or use the automated provisioning script:
```bash
./provision-vm.sh
```

### Step 3: Inspect Files

Now you can safely inspect suspicious files:

```bash
./inspect.sh suspicious-file.pdf
```

Or:

```bash
# Copy file to shared directory first
cp ~/Downloads/sketchy-invoice.exe shared/
./inspect.sh sketchy-invoice.exe
```

## Project Structure

```
analyze-malware-sandbox/
├── setup-sandbox.sh      # Initial setup (downloads ISO, generates keys)
├── provision-vm.sh       # Automates Alpine Linux configuration
├── inspect.sh            # Analyze files in isolated VM
├── status.sh             # Check sandbox health
├── alpine.iso            # Alpine Linux installation ISO
├── shared/               # Read-only directory shared with VM
│   └── analyze.sh        # Analysis script (runs inside VM)
└── SETUP-GUIDE.md        # Detailed setup instructions
```

## Analysis Tools

- File identification: `file`, `strings`, `hexyl`, `exiftool`
- Malware detection: `clamav`, `yara`, `ssdeep`
- Office documents: `oletools`, `olevba`, `oleid`
- PDF analysis: `pdfinfo`, JavaScript detection
- Executables: `radare2`, `readelf`
- Archives: `unzip`, `p7zip`, `unrar`, `cabextract`

## Usage Examples

```bash
# Inspect email attachment
./inspect.sh suspicious-invoice.pdf

# Manual analysis (advanced)
ssh -i id_rsa -p 2222 root@localhost
/media/shared/analyze.sh scan /media/shared/file.exe
```

## Useful Commands

```bash
utmctl start inspection-sandbox    # Start VM
utmctl stop inspection-sandbox     # Stop VM
./status.sh                         # Check health
./setup-sandbox.sh burn             # Destroy and start over
```

## Security Features

- Network isolation (VM cannot access internet or LAN)
- Read-only file sharing (malware cannot modify host)
- No clipboard sharing
- Minimal attack surface (Alpine Linux)
- Disposable (destroy and recreate anytime)
- SSH key authentication only

## Troubleshooting

See [TROUBLESHOOTING.md](TROUBLESHOOTING.md) for detailed solutions.

**Common issues:**
- VM boots to UEFI shell: Type `fs0:` then `\EFI\BOOT\BOOTX64.EFI`
- SSH fails: Check VM status with `./status.sh`
- Shared directory not mounting: Verify VirtFS mode in UTM settings

## Documentation

- [SETUP-GUIDE.md](SETUP-GUIDE.md) - Detailed setup instructions
- [QUICKSTART.md](QUICKSTART.md) - Quick reference
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Common issues and solutions
- [PKI-SECURITY.md](PKI-SECURITY.md) - SSH key management

## License

MIT License
