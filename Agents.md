# AI Agent Guidelines - scripts

> **Generated by**: [golden-agents](https://github.com/bordenet/golden-agents) v1.4.0 (progressive)
> **Last Updated**: 2026-02-05
> **Languages**: shell
> **Type**: general

Minimal core with on-demand module loading. Templates at: `$HOME/.golden-agents/templates/`
<!-- GOLDEN:self-manage:start -->
## âš ï¸ Before ANY Task
1. Load `.ai-guidance/invariants.md` â€” contains critical rules
2. After editing ANY guidance file, check: `wc -l Agents.md .ai-guidance/*.md 2>/dev/null`
   - `Agents.md` >150 lines â†’ refactor into `.ai-guidance/`
   - Any `.ai-guidance/*.md` >250 lines â†’ split into sub-directory
<!-- GOLDEN:self-manage:end -->
<!-- GOLDEN:framework:start -->

---

## Quality Gates (MANDATORY)

Before ANY commit:
1. **Lint**: `shellcheck *.sh`
2. **Build**: `bash -n *.sh`
3. **Test**: `bats test/`
4. **Coverage**: Minimum N/A%

**Order matters.** Lint â†’ Build â†’ Test. Never skip steps.

---

## Communication Rules

- **No flattery** - Skip "Great question!" or "Excellent point!"
- **No hype** - Avoid "revolutionary", "game-changing", "seamless"
- **Evidence-based** - Cite sources or qualify as opinion
- **Direct** - State facts without embellishment

**Banned phrases**: production-grade, world-class, leverage, utilize, incredibly, extremely, Happy to help!

---

## ðŸš¨ Progressive Module Loading

**STOP and load the relevant module BEFORE these actions:**

### Language Modules (ðŸ”´ Required)
- ðŸ”´ **BEFORE writing ANY `.sh` file or bash code block**: Read `$HOME/.golden-agents/templates/languages/shell.md`

### Workflow Modules (ðŸ”´ Required)
- ðŸ”´ **BEFORE any commit, PR, push, or merge**: Read `$HOME/.golden-agents/templates/workflows/security.md`
- ðŸ”´ **WHEN tests fail OR after 2+ failed fix attempts**: Read `$HOME/.golden-agents/templates/workflows/testing.md`
- ðŸ”´ **WHEN build fails OR lint errors appear**: Read `$HOME/.golden-agents/templates/workflows/build-hygiene.md`
- ðŸŸ¡ **BEFORE deploying to any environment**: Read `$HOME/.golden-agents/templates/workflows/deployment.md`
- ðŸŸ¡ **WHEN conversation exceeds 50 exchanges**: Read `$HOME/.golden-agents/templates/workflows/context-management.md`

### Optional: Superpowers integration

If [superpowers](https://github.com/obra/superpowers) is installed, run at session start:

```bash
node ~/.codex/superpowers-augment/superpowers-augment.js bootstrap
```

<!-- GOLDEN:framework:end -->

---

## Project-Specific Rules

**CRITICAL**: Read [STYLE_GUIDE.md](./STYLE_GUIDE.md) before making changes. It is the authoritative source.

### Repository Status

All 80+ scripts are 100% compliant:
- âœ… Zero ShellCheck warnings
- âœ… All use `set -euo pipefail` (except bu.sh/mu.sh)
- âœ… All implement `-h/--help` and `-v/--verbose`
- âœ… Pre-commit hook enforced

---

## User Environment

- **All hardware is Apple Silicon** (ARM64 architecture)
- Homebrew paths: `/opt/homebrew/` (not `/usr/local/`)
- When suggesting paths, always use Apple Silicon defaults first
- **macOS uses BSD tools, not GNU** - always test awk/sed/grep syntax
  - BSD awk does NOT support `match()` with array capture
  - Use `grep | sed` pipelines instead of complex awk
  - Test all regex/text processing commands before committing
  - See [STYLE_GUIDE.md Â§ Platform Compatibility](./STYLE_GUIDE.md#platform-compatibility) for details

## Pre-Commit Checklist

**See [STYLE_GUIDE.md](./STYLE_GUIDE.md) for the full pre-commit checklist.** Quick reference:

```bash
shellcheck -S warning script.sh    # Zero warnings required
bash -n script.sh                  # Syntax validation
./script.sh --help                 # Actually run it!
./validate-script-compliance.sh    # Full compliance check
```

---

## Impact Analysis: Before ANY Deletion/Rename

```bash
# 1. Search for references FIRST
grep -r "FILENAME" --include="*.md" --include="*.sh" .

# 2. Validate everything together
./validate-cross-references.sh && ./validate-script-compliance.sh

# 3. Only then commit (atomically - all related changes in ONE commit)
```

**Validation tools:**
- `./validate-cross-references.sh` - Markdown link validation
- `./validate-script-compliance.sh` - STYLE_GUIDE.md compliance
- `./ci-quality-gates.sh` - Full CI check locally

### Lessons Learned: Real Failures

**Failure Case 1: Incomplete deletion (2025-11-25)**
- **What happened**: Deleted TECHNICAL_DEBT.md without checking references
- **Impact**: Left broken links in README.md and Agents.md
- **Root cause**: Didn't search for references before deletion
- **Prevention**: ALWAYS `grep -r "FILENAME"` before deleting

**Failure Case 2: Incomplete documentation (2025-11-25)**
- **What happened**: Updated README.md without checking completeness
- **Impact**: 5 user-facing scripts undocumented
- **Root cause**: Didn't compare `ls *.sh` against README.md
- **Prevention**: ALWAYS audit completeness when editing documentation

**Failure Case 3: `set -euo pipefail` abort (2025-11-29)**
- **What happened**: `fetch-github-projects.sh --all` aborted immediately after showing "Updating CallBox..."
- **Impact**: Script terminated with non-zero exit code, user's workflow broken
- **Root cause**: The pipeline `git remote show origin 2>/dev/null | awk '/HEAD branch/ {print $NF}'` failed silently when the network command failed. With `pipefail`, the entire script aborted.
- **Similar issues found in**: 6 scripts with `stop_timer()` functions using bare `kill`/`wait` commands
- **Prevention**:
  - ALWAYS add `|| true` to network-dependent pipelines that shouldn't abort the script
  - ALWAYS add `|| true` to `kill` and `wait` commands in cleanup functions
  - ALWAYS test scripts with simulated network failures
  - See [STYLE_GUIDE.md Â§ Surviving `set -euo pipefail`](./STYLE_GUIDE.md#surviving-set--euo-pipefail) for patterns

**Failure Case 4: Missing variable export breaks production (2025-11-29)**
- **What happened**: Added real-time progress feature using `$CYAN` color variable in lib/bu-lib.sh
- **Impact**: Script crashed immediately with "CYAN: unbound variable" when run with `set -u`
- **Root cause**: Added code using `$CYAN` in library but failed to export `CYAN` in calling script (bu.sh)
- **Prevention**:
  - **MANDATORY**: Actually RUN the script before committing, don't just check syntax
  - Test library changes: `bash -c 'export VAR1=val; source lib/file.sh; function_name'`
  - With `set -u`, missing exports cause immediate failure - this is catchable by running the script
  - **NO EXCEPTIONS**: If you modify a library, you MUST test it by actually calling it
  - This failure was 100% preventable by running `./bu.sh --help` before committing

**Failure Case 5: Widespread STYLE_GUIDE.md non-compliance (2025-11-29)**
- **What happened**: User discovered fetch-github-projects.sh lacked --verbose flag (STYLE_GUIDE.md requirement)
- **Impact**: Audit revealed 24 out of 30 scripts (80%) lacked mandatory --verbose flag
- **Root cause**:
  - STYLE_GUIDE.md added --verbose requirement but never enforced retroactively
  - Agents.md pre-commit checklist didn't explicitly verify --verbose presence
  - validate-script-compliance.sh didn't catch this violation
  - Scripts were grandfathered in without compliance audit
- **Prevention**:
  - **MANDATORY**: Pre-commit checklist step 1 now verifies STYLE_GUIDE.md compliance
  - Explicit checks for: `-h/--help`, `-v/--verbose`, `--what-if` (destructive scripts)
  - When adding new requirements to STYLE_GUIDE.md, MUST audit ALL existing scripts
  - When adding new requirements to STYLE_GUIDE.md, MUST update validate-script-compliance.sh
  - **NO EXCEPTIONS**: New scripts MUST pass all STYLE_GUIDE.md requirements before first commit

### The Golden Rule of Changes

**NEVER make a change in isolation. ALWAYS:**

1. âœ… Search for ALL impacts FIRST
2. âœ… Plan ALL related changes
3. âœ… Make ALL changes atomically
4. âœ… Validate BEFORE committing
5. âœ… Run validation scripts

**If you skip any step, you WILL create broken references, incomplete documentation, or inconsistent state.**

---

## Pre-Push Audit

**Before pushing**: Run `./ci-quality-gates.sh` - this runs all validation checks automatically.
